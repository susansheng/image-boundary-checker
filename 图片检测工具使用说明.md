# 图片规范检测工具使用说明

## 功能描述

这个工具可以自动检测上传的图片是否符合以下规范：

1. **尺寸要求**：图片必须是 300px × 200px
2. **安全区域要求**：图片内容（非透明像素）必须在安全区域内，不能与红色边框区域重叠

## 安全区域边界

根据模板图片分析，安全区域的边界为：
- 左边界：14px
- 右边界：285px
- 上边界：24px
- 下边界：175px

即：图片内容必须在矩形区域 `(14, 24)` 到 `(285, 175)` 内。

## 使用方法

### 基本用法

```bash
python3 image_validator.py <待检测图片路径>
```

### 使用示例

```bash
# 检测单张图片
python3 image_validator.py test_image.png

# 检测多张图片（使用循环）
for img in *.png; do
    python3 image_validator.py "$img"
done
```

## 输出结果

### 符合规范的输出示例
```
============================================================
图片规范检测工具
============================================================

1. 分析模板图片: /Users/sxsheng/Downloads/模板.png
   安全区域边界: 左=14, 右=285, 上=24, 下=175

2. 检测图片: test_image.png

============================================================
✓ 检测结果: 图片符合规范
============================================================
```

### 不符合规范的输出示例
```
============================================================
图片规范检测工具
============================================================

1. 分析模板图片: /Users/sxsheng/Downloads/模板.png
   安全区域边界: 左=14, 右=285, 上=24, 下=175

2. 检测图片: bad_image.png

============================================================
✗ 检测结果: 图片不符合规范

错误详情:
  1. 图片尺寸不符合要求: 400x300, 要求: 300x200
  2. 发现 150 个像素超出安全区域（与红色边框重叠）
  3. 超出位置示例: [(5, 10), (6, 10), (7, 10), ...]
============================================================
```

## 在代码中使用

你也可以在自己的 Python 代码中导入使用：

```python
from image_validator import analyze_template, check_image_compliance

# 分析模板，获取安全区域
safe_area = analyze_template("/Users/sxsheng/Downloads/模板.png")

# 检测图片
is_compliant, errors = check_image_compliance("test.png", safe_area, verbose=True)

if is_compliant:
    print("图片符合规范")
else:
    print("图片不符合规范:")
    for error in errors:
        print(f"  - {error}")
```

## 技术实现

- 使用 Python PIL/Pillow 库进行图像处理
- 自动分析模板图片的红色边框边界
- 逐像素检测图片内容是否超出安全区域
- 支持透明通道（alpha < 10 的像素视为透明）

## 依赖安装

```bash
pip install Pillow
```

## 注意事项

1. 模板图片路径默认为 `/Users/sxsheng/Downloads/模板.png`，如需修改请编辑脚本中的 `template_path` 变量
2. 工具会检测所有 alpha 值大于 10 的像素（几乎透明的像素会被忽略）
3. 退出代码：符合规范返回 0，不符合返回 1（便于在脚本中判断）
