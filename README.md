# 图片边界验收工具

## 📋 项目简介

这是一个自动化的图片规范检测工具，用于验证上传的图片是否符合特定的尺寸和边界要求。

## ✨ 功能特性

- ✅ **智能自动缩放** - 支持任意尺寸图片，自动缩放到 300×200 进行检测
- 🔧 **自动修复** - 当检测不通过时，智能调整图片使其符合规范
- ✅ 自动检测图片内容是否在安全区域内
- ✅ 支持透明通道图片
- ✅ 详细的错误报告和警告提示
- ✅ 命令行友好，支持批量处理
- 🌐 提供 Web 界面，支持拖拽上传
- 📊 显示原始尺寸和缩放后的对比
- 📥 批量检测与修复，支持从 Excel/CSV 批量导入

## 📁 文件说明

```
图片边界验收工具/
├── README.md                      # 项目说明文档（本文件）
├── 自动缩放功能说明.md             # 自动缩放功能详解
├── 图片检测工具使用说明.md         # 详细使用文档
├── Web界面使用指南.md              # Web 界面使用教程
├── 端口使用说明.md                 # 端口管理说明
├── image_validator.py             # 命令行检测工具
├── web_validator.py               # Web 界面版本
├── image_fixer.py                 # 图片自动修复模块 ⭐新增
├── start_server.sh                # 启动 Web 服务器脚本
├── port_manager.py                # 端口管理工具
├── generate_test_images.py        # 测试图片生成工具
├── test_auto_resize.py            # 自动缩放测试图片生成工具
├── templates/                     # Web 界面模板
│   └── index.html
├── api/                           # Vercel Serverless 部署
│   └── index.py
├── 测试图片（标准尺寸）
│   ├── test_compliant.png         # 符合规范（300×200）
│   ├── test_wrong_size.png        # 尺寸错误（400×300）
│   ├── test_out_of_bounds.png     # 内容超出边界（300×200）
│   └── test_edge_case.png         # 边界情况（300×200）
└── 测试图片（自动缩放）
    ├── test_large_compliant.png   # 大尺寸符合规范（600×400）
    ├── test_small_compliant.png   # 小尺寸符合规范（150×100）
    └── test_large_non_compliant.png # 大尺寸超出边界（800×600）
```

## 🚀 快速开始

### 方式一：使用 Web 界面（推荐）

**1. 启动 Web 服务器**

```bash
# 方式 1：使用启动脚本（推荐）
./start_server.sh

# 方式 2：直接运行
python3 web_validator.py
```

**2. 打开浏览器访问**

在浏览器中打开：
- http://localhost:5000
- 或 http://127.0.0.1:5000

**3. 上传图片检测**

- 点击上传区域选择图片
- 或直接拖拽图片到上传区域
- 立即查看检测结果

### 方式二：使用命令行工具

### 1. 安装依赖

```bash
pip install Pillow flask
```

### 2. 基本使用

```bash
# 检测单张图片
python3 image_validator.py your_image.png

# 检测多张图片
python3 image_validator.py image1.png image2.png
```

### 3. 批量检测

```bash
# 检测当前目录下所有 PNG 图片
for img in *.png; do
    python3 image_validator.py "$img"
done
```

## 🎯 智能自动缩放功能

**新功能！** 工具现在支持任意尺寸的图片：

- 📏 **接受任意尺寸** - 不再限制必须是 300×200
- 🔄 **自动缩放** - 智能缩放到 300×200 进行检测
- 📊 **对比展示** - 显示原始尺寸和缩放后的图片
- ⚠️ **智能提示** - 清楚标注是否进行了缩放

**工作原理：**
1. 上传任意尺寸的图片（如 800×600、150×100）
2. 工具自动缩放到 300×200
3. 检测缩放后的内容是否在安全区域内
4. 显示原始尺寸和检测结果

详细说明请查看：[自动缩放功能说明.md](./自动缩放功能说明.md)

## 🔧 自动修复功能

**新增功能！** 工具现在支持自动修复不符合规范的图片：

### 核心特性

- 🎯 **智能裁剪（推荐）** - 自动找到最佳内容区域，确保内容在安全区域内
- ➕ **添加边距** - 在图片四周添加白边或透明边，将内容推入安全区域
- 📏 **保持原始尺寸** - 修复后的图片保持原图大小，不会改变分辨率
- 💾 **PNG格式导出** - 修复后的图片以PNG格式保存，保留透明通道
- 📦 **批量修复** - 支持批量检测并修复多张图片
- 📥 **智能命名** - 从URL中提取文件名（包含数字标识）

### 使用方法

#### 单张图片修复

1. 上传图片进行检测
2. 如果检测不通过，会显示"自动修复"按钮
3. 选择修复策略：
   - **智能裁剪（推荐）**：分析图片内容，找到最佳裁剪区域
   - **添加白边**：在图片周围添加边距
4. 点击"开始修复"
5. 查看修复后的预览图
6. 点击"下载修复后的图片"保存PNG格式文件

#### 批量修复

1. 在"批量检测"标签页上传Excel/CSV文件
2. 等待批量检测完成
3. 对于不符合规范的图片，点击卡片上的"🔧 修复"按钮
4. 修复完成后，点击"📥 下载"按钮保存图片

### 修复策略对比

| 策略 | 适用场景 | 优点 | 注意事项 |
|------|---------|------|---------|
| **智能裁剪** | 内容可以裁剪的图片 | 保持图片原始质量，内容居中 | 可能会裁掉部分边缘内容 |
| **添加边距** | 内容较满，不适合裁剪 | 保留全部内容 | 图片内容会被缩小 |

### 文件命名规则

修复后的图片文件名按以下优先级提取：

1. **纯数字文件名** - `/12345.jpg` → `12345.png`
2. **带数字的文件名** - `/image_123.jpg` → `image_123.png`
3. **查询参数ID** - `?id=456` → `456.png`
4. **默认命名** - `domain_timestamp.png`

### 技术原理

修复操作在原图尺寸上进行，通过坐标映射实现：

```
1. 原图 → 缩放到300×200检测
2. 检测边界 → 计算修复方案
3. 映射坐标回原图 → 在原图上应用修复
4. 导出PNG格式
```

**关键点**：修复在原图尺寸上操作，确保图片质量不受影响。

## 📊 检测规范

### 尺寸要求
- 宽度：300px
- 高度：200px

### 安全区域要求
图片内容（非透明像素）必须在以下区域内：
- 左边界：14px
- 右边界：285px
- 上边界：24px
- 下边界：175px

即：所有可见内容必须在矩形 `(14, 24)` 到 `(285, 175)` 范围内，不能与红色边框区域重叠。

## 💡 使用示例

### 示例 1：检测单张图片

```bash
$ python3 image_validator.py product_image.png

============================================================
图片规范检测工具
============================================================

1. 分析模板图片: /Users/sxsheng/Downloads/模板.png
   安全区域边界: 左=14, 右=285, 上=24, 下=175

2. 检测图片: product_image.png

============================================================
✓ 检测结果: 图片符合规范
============================================================
```

### 示例 2：检测不合规图片

```bash
$ python3 image_validator.py bad_image.png

============================================================
✗ 检测结果: 图片不符合规范

错误详情:
  1. 图片尺寸不符合要求: 400x300, 要求: 300x200
  2. 发现 1500 个像素超出安全区域（与红色边框重叠）
============================================================
```

## 🧪 测试工具

项目包含测试图片生成工具，可生成各种场景的测试图片：

```bash
python3 generate_test_images.py
```

生成的测试图片包括：
- `test_compliant.png` - 符合规范
- `test_wrong_size.png` - 尺寸不符合
- `test_out_of_bounds.png` - 内容超出边界
- `test_edge_case.png` - 边界情况测试

## 📖 详细文档

更多使用说明请参阅：[图片检测工具使用说明.md](./图片检测工具使用说明.md)

## 🔧 技术实现

- **开发语言**：Python 3
- **核心库**：Pillow (PIL)
- **Web 框架**：Flask
- **前端技术**：HTML5, CSS3, JavaScript
- **检测方式**：像素级扫描
- **支持格式**：PNG, JPEG 及其他常见图片格式

## ⚙️ 配置说明

模板图片路径默认为：`/Users/sxsheng/Downloads/模板.png`

如需修改，请编辑 `image_validator.py` 文件中的 `template_path` 变量。

## 📝 返回值说明

- **退出代码 0**：图片符合规范
- **退出代码 1**：图片不符合规范

这使得工具可以方便地集成到自动化流程中。

## 🎯 典型应用场景

- 电商平台商品图片审核
- 内容管理系统图片上传验证
- 批量图片质量检查
- CI/CD 流程中的图片规范检测

## 📞 问题反馈

如有问题或建议，请联系开发者。

---

**最后更新时间**：2026-02-07

**更新内容**：
- ✨ 新增自动修复功能
- 🎯 支持智能裁剪和添加边距两种修复策略
- 📥 支持批量修复和下载
- 💾 修复后的图片保持原始尺寸，PNG格式导出
