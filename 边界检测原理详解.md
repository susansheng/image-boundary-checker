# 边界检测原理详解

## 📋 总体概述

工具通过**逐像素扫描**的方式，检测图片内容是否超出红色边框的安全区域。

## 🎯 核心原理

### 第一步：确定安全区域边界

**模板图片结构：**
- 尺寸：300 × 200 像素
- 红色边框：外围禁区（不能放置内容）
- 白色区域：安全区（可以放置内容）

**边界坐标：**
```
左边界 (left):   14px
右边界 (right):  285px
上边界 (top):    24px
下边界 (bottom): 175px
```

这些边界是通过扫描模板图片的颜色自动识别的：
- 从左边第14个像素开始是白色 → 左边界 = 14
- 从右边倒数第15个像素是白色 → 右边界 = 285
- 从上边第24个像素开始是白色 → 上边界 = 24
- 从下边倒数第25个像素是白色 → 下边界 = 175

### 第二步：检测上传图片的每个像素

**处理流程：**

1. **缩放图片** → 统一缩放到 300 × 200
2. **遍历像素** → 扫描所有 60,000 个像素
3. **检查透明度** → 跳过透明像素 (alpha ≤ 10)
4. **检查位置** → 判断不透明像素的坐标是否在安全区域内

**检测逻辑：**

```python
for y in range(200):           # 遍历每一行
    for x in range(300):       # 遍历每一列
        pixel = img.getpixel((x, y))
        alpha = pixel[3]       # 透明度

        if alpha > 10:         # 如果不透明
            # 检查是否超出边界
            if (x < 14 or x > 285 or y < 24 or y > 175):
                # 这个像素超出了安全区域！
                out_of_bounds_pixels.append((x, y))
```

**判断条件：**

一个像素在安全区域内，必须同时满足：
- `x >= 14` （不超出左边界）
- `x <= 285` （不超出右边界）
- `y >= 24` （不超出上边界）
- `y <= 175` （不超出下边界）

只要有任何一个条件不满足，就认为该像素超出了边界。

### 第三步：统计结果

```
超出像素数 = 0  → ✓ 检测通过（符合规范）
超出像素数 > 0  → ✗ 检测失败（不符合规范）
```

## 📊 可视化说明

### 模板图片坐标系

```
    x: 0              14            285  299
       ┌───────────────┬──────────────┬───┐
    0  │               │              │   │
       │   红色边框    │  白色安全区  │红 │
       │               │              │色 │
   24  ├───────────────┴──────────────┴───┤
       │                                  │
       │         白色安全区域              │
       │      (图片内容必须在这里)         │
  100  │                                  │
       │                                  │
  175  ├───────────────┬──────────────┬───┤
       │   红色边框    │              │红 │
       │               │              │色 │
  199  └───────────────┴──────────────┴───┘

y 轴
```

**坐标说明：**
- 原点 (0, 0) 在左上角
- x 轴向右递增（0 → 299）
- y 轴向下递增（0 → 199）
- 安全区域：从 (14, 24) 到 (285, 175)

## 💡 实例演示

### 示例 1：合规的像素 ✓

**像素坐标：(150, 100)**

检查过程：
```
x = 150
y = 100

检查 x >= 14?   → 150 >= 14  → ✓ 通过
检查 x <= 285?  → 150 <= 285 → ✓ 通过
检查 y >= 24?   → 100 >= 24  → ✓ 通过
检查 y <= 175?  → 100 <= 175 → ✓ 通过

结论：所有条件满足 → 在安全区域内 ✓
```

### 示例 2：超出左边界 ✗

**像素坐标：(10, 100)**

检查过程：
```
x = 10
y = 100

检查 x >= 14?   → 10 >= 14  → ✗ 失败

结论：超出左边界 → 不符合规范 ✗
```

### 示例 3：超出上边界 ✗

**像素坐标：(150, 10)**

检查过程：
```
x = 150
y = 10

检查 x >= 14?   → 150 >= 14 → ✓ 通过
检查 x <= 285?  → 150 <= 285 → ✓ 通过
检查 y >= 24?   → 10 >= 24  → ✗ 失败

结论：超出上边界 → 不符合规范 ✗
```

### 示例 4：边界上的像素 ✓

**像素坐标：(14, 24)** - 刚好在边界线上

检查过程：
```
x = 14
y = 24

检查 x >= 14?   → 14 >= 14  → ✓ 通过（等于边界值）
检查 x <= 285?  → 14 <= 285 → ✓ 通过
检查 y >= 24?   → 24 >= 24  → ✓ 通过（等于边界值）
检查 y <= 175?  → 24 <= 175 → ✓ 通过

结论：刚好在边界上也算合规 → 在安全区域内 ✓
```

## 🔑 关键要点

1. **边界值算在安全区域内**
   - 左边界 x=14 是合规的
   - 右边界 x=285 是合规的
   - 上边界 y=24 是合规的
   - 下边界 y=175 是合规的

2. **透明像素不参与检测**
   - 只检测 alpha > 10 的像素
   - 接近完全透明的像素会被忽略

3. **一票否决制**
   - 只要有一个像素超出边界
   - 整张图片就判定为不符合规范

4. **检测基于缩放后的图片**
   - 所有图片统一缩放到 300×200
   - 然后基于统一尺寸进行检测

## 🎯 检测流程图

```
上传任意尺寸的图片
        ↓
    缩放到 300×200
        ↓
遍历所有 60,000 个像素
        ↓
    对每个像素：
        ↓
    ┌─────────────┐
    │ 透明吗？    │
    └─────────────┘
      ↓ 是    ↓ 否
    跳过    检查坐标
              ↓
         ┌──────────────┐
         │ x: 14-285?   │
         │ y: 24-175?   │
         └──────────────┘
           ↓ 是    ↓ 否
         合规    记录超出
              ↓
         继续下一个像素
              ↓
        所有像素扫描完成
              ↓
         ┌──────────────┐
         │ 统计超出数量 │
         └──────────────┘
           ↓         ↓
        = 0         > 0
           ↓         ↓
        ✓ 通过    ✗ 失败
```

## 💻 核心代码

```python
# 定义安全区域边界
SAFE_AREA = {
    'left': 14,
    'right': 285,
    'top': 24,
    'bottom': 175
}

# 检测函数
def check_pixel(x, y, alpha):
    """检查单个像素是否符合规范"""

    # 1. 检查透明度
    if alpha <= 10:
        return True  # 透明像素，跳过

    # 2. 检查是否在安全区域内
    if (x < SAFE_AREA['left'] or
        x > SAFE_AREA['right'] or
        y < SAFE_AREA['top'] or
        y > SAFE_AREA['bottom']):
        return False  # 超出边界

    return True  # 在安全区域内

# 完整检测流程
out_of_bounds_pixels = []

for y in range(200):
    for x in range(300):
        pixel = img.getpixel((x, y))
        alpha = pixel[3]

        if not check_pixel(x, y, alpha):
            out_of_bounds_pixels.append((x, y))

# 判断结果
if len(out_of_bounds_pixels) == 0:
    print("✓ 检测通过")
else:
    print(f"✗ 发现 {len(out_of_bounds_pixels)} 个像素超出边界")
```

## 📈 性能说明

- **检测速度**：约 0.1-0.5 秒
- **扫描像素数**：60,000 个 (300 × 200)
- **内存占用**：约 1-2 MB（单张图片）
- **准确率**：像素级精度

## 🎓 总结

工具通过以下三步判断图片是否符合规范：

1. **确定标准** - 从模板图片识别安全区域边界（14, 24, 285, 175）
2. **逐像素检测** - 扫描所有不透明像素，检查坐标是否在安全区域内
3. **统计结果** - 只要有像素超出边界，就判定为不符合规范

这是一个**严格**且**精确**的检测标准，确保图片内容完全在安全区域内。
